<!-- payment methods -->
<div class="content" *ngIf="paymentMethods !== undefined">
    <!-- table -->
    <fz-panel-table class="doc-card-margin mt-4">

        <!-- header -->
        <ng-container desc>
            <i class="mr-2 fas fa-credit-card"></i> Payment Methods
        </ng-container>

        <fz-table table>
            <tr header>
                <th class="text-center">Brand</th>
                <th class="text-center">Last Four</th>
                <th class="text-center">Expiration</th>
                <th class="text-center">Default</th>
                <th></th>
            </tr>
            <tr *ngFor="let paymentMethod of paymentMethods">
                <td class="text-center">{{ paymentMethod.brand }}</td>
                <td class="text-center">{{ paymentMethod.last_four }}</td>
                <td class="text-center">{{ paymentMethod.exp_month}} / {{paymentMethod.exp_year}}</td>
                <td class="d-flex justify-content-center"><div *ngIf="paymentMethod.default"><fz-icon-color-circle color="success" icon="fas fa-check"></fz-icon-color-circle></div></td>
                <td>
                    <div class="d-flex justify-content-end" *ngIf="!paymentMethod.default">
                        <a fzTip content="Make default" href="javascript:void(0);" class="mr-2">
                            <fz-icon-color-circle color="secondary" icon="fas fa-check" (click)="makeDefault(paymentMethod)"></fz-icon-color-circle>
                        </a>
                        <a fzTip content="Delete payment method" href="javascript:void(0);">
                            <fz-icon-color-circle color="danger" icon="fas fa-trash" (click)="paymentMethodToDelete = paymentMethod; deletemodal.show()"></fz-icon-color-circle>
                        </a>
                    </div>
                </td>
            </tr>
        </fz-table>

        <div class="pl-3 pt-3" table *ngIf="paymentMethods.length === 0">
            You don't have any payment methods
        </div>
        <div class="pl-3 pt-3" table>
            <button class="mr-2 mb-2" fzButton [rounded]="true" color="primary" size="sm" (click)="addPaymentMethodModal.show()">Add new payment method</button>
        </div>
        <!-- footer -->
        <ng-container tRows [ngPlural]="paymentMethods.length">
            {{paymentMethods.length}}
            <ng-template ngPluralCase="=1">Payment Method</ng-template>
            <ng-template ngPluralCase="other">Payment Methods</ng-template>
        </ng-container>
    </fz-panel-table>
</div>

<fz-modal headerTitle="Add new payment method" footerPosition="end" #addPaymentMethodModal size="md" centered="true">
    <ng-container content>
        <form [formGroup]="paymentMethodForm" (ngSubmit)="addPaymentMethod();addPaymentMethodModal.hide()">
            <div class="mt-5 mb-5">
                <ngx-stripe-card (change)="onPaymentMethodFormChange($event)" [stripe]="stripe" [options]="cardOptions" [elementsOptions]="elementsOptions"></ngx-stripe-card>
            </div>
            <div class="mt-5 align-content-right">
                <button [disabled]="!paymentMethodForm.valid" class="mr-2" fzButton [rounded]="true" color="primary" type="submit">
                    Save
                </button>
                <button fzButton [rounded]="true" type="button" color="danger" (click)="addPaymentMethodModal.hide()">Cancel</button>
            </div>
        </form>
    </ng-container>
</fz-modal>

<fz-modal-dialog [confirmClose]="true" #deletemodal>
    <ng-container icon><i fzColor textColor="warning" class="fas fa-exclamation-circle"></i></ng-container>
    <div text>
        <h5 class="text-center">Are you sure you want to delete the payment method ending in <strong>{{paymentMethodToDelete?.last_four}}</strong>?</h5>
    </div>
    <ng-container buttons>
        <button class="mr-2" fzButton [rounded]="true" size="lg" color="primary" (click)="removePaymentMethod();deletemodal.confirm()">
            Yes
        </button>
        <button fzButton [rounded]="true" size="lg" color="danger" (click)="deletemodal.hide()">No</button>
    </ng-container>
</fz-modal-dialog>
