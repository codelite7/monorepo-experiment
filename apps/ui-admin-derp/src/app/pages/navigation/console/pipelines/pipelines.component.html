<div class="content" *ngIf="pipelines !== undefined">

    <!-- table complete -->
    <fz-panel-table class="doc-card-margin mt-4">

        <!-- header -->
        <ng-container desc>
                <i class="mr-2 fas fa-code-branch"></i>Pipelines
            <app-docslink class="ml-3" link="https://swarmio-labs.gitbook.io/platform-documentation/concepts/pipelines"></app-docslink>
        </ng-container>

        <ng-container search>
            <input type="text" placeholder="Search..." name="search" [(ngModel)]="search" class="form-control">
        </ng-container>

        <ng-container actions>
            <fz-dropdown direction="left-start">
                <a button fzButton color="secondary" href="javascript:void(0);">
                    <i class="fas fa-ellipsis-v"></i>
                </a>
                <a fzDropdownItem routerLink="create"><i class="icon m-right fas fa-plus-circle"></i>New Pipeline</a>
            </fz-dropdown>
        </ng-container>

        <!-- table -->
        <fz-table table *ngIf="(pipelines | fzFilter: search).length > 0">
            <tr header>
                <th>Name</th>
                <th>Steps</th>
                <th>Outputs</th>
                <th>Max Retries</th>
                <th>Retry Interval</th>
                <th></th>
            </tr>
            <tr *ngFor="let item of pipelines | fzFilter: search;">
                <th>{{ item.name }}</th>
                <td>{{ item.steps.length }}</td>
                <td>{{ item.outputs.length }}</td>
                <td>{{ item.max_retries }}</td>
                <td>{{ item.retry_interval }}</td>
                <td>
                    <div class="d-flex justify-content-end">
                        <a fzTip content="Reset position" href="javascript:void(0);"
                           (click)="pipeline = item; resetPositionModal.show()" class="mr-2">
                            <fz-icon-color-circle color="secondary" icon="fas fa-history"></fz-icon-color-circle>
                        </a>
                        <a fzTip content="Copy publish url to clipboard" href="javascript:void(0);" class="mr-2">
                            <fz-icon-color-circle color="secondary" icon="fas fa-clipboard" ngxClipboard
                                                  [cbContent]="getPublishUrl(item.id)"></fz-icon-color-circle>
                        </a>
                        <a fzTip content="Edit pipeline" class="mr-2" routerLink="{{item.id}}">
                            <fz-icon-color-circle color="secondary" icon="fas fa-pen-square"></fz-icon-color-circle>
                        </a>
                        <a fzTip content="Delete pipeline" href="javascript:void(0);">
                            <fz-icon-color-circle color="danger" icon="fas fa-trash"
                                                  (click)="pipeline = item; modal.show()"></fz-icon-color-circle>
                        </a>
                    </div>
                </td>
            </tr>
        </fz-table>

        <div class="pl-3 pt-3" table
             *ngIf="pipelines.length > 0 && search && (pipelines | fzFilter: search).length == 0">
            No results found for <strong>"{{ search }}"</strong>.
        </div>
        <div class="pl-3 pt-3" table *ngIf="pipelines.length === 0">
            You don't have any pipelines
        </div>
        <div class="pl-3 pt-3" table>
            <button routerLink="create" class="mr-2 mb-2" fzButton [rounded]="true" color="primary" size="sm">Create New
                Pipeline
            </button>
        </div>
        <!-- footer -->
        <ng-container tRows *ngIf="(pipelines | fzFilter: search).length > 0" [ngPlural]="pipelines.length">
            <div>
                {{ (pipelines | fzFilter: search).length }}
                <ng-template ngPluralCase="=0">pipelines</ng-template>
                <ng-template ngPluralCase="=1">pipeline</ng-template>
                <ng-template ngPluralCase="other">pipelines</ng-template>
            </div>
        </ng-container>

        <fz-pagination *ngIf="(pipelines | fzFilter: search).length > 0" pagination
                       [rows]="(pipelines | fzFilter: search).length" [perPage]="10"
                       [actionNumbers]="false" [textBtNextPrev]="false"></fz-pagination>

    </fz-panel-table>
</div>

<fz-modal-dialog [confirmClose]="true" #modal>
    <ng-container icon><i fzColor textColor="warning" class="fas fa-exclamation-circle"></i></ng-container>
    <div text>
        <h5 class="text-center">Are you sure you want to delete the pipeline named <strong>{{pipeline?.name}}</strong>?
        </h5>
        <p class="text-center">This cannot be undone in the future.</p>
    </div>
    <ng-container buttons>
        <button class="mr-2" fzButton [rounded]="true" size="lg" color="primary"
                (click)="deletePipeline();modal.confirm()">
            Yes
        </button>
        <button fzButton [rounded]="true" size="lg" color="danger" (click)="modal.hide()">No</button>
    </ng-container>
</fz-modal-dialog>

<app-reset-position id="{{pipeline?.id}}" name="{{pipeline?.name}}" type="PIPELINE" #resetPositionModal></app-reset-position>
