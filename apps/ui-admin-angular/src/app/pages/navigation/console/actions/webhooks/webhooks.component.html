<div class="content" *ngIf="webhookActions !== undefined">

    <!-- table complete -->
    <fz-panel-table class="doc-card-margin mt-4">

        <!-- header -->
        <ng-container desc>
            <i class="mr-2 fas fa-wifi"></i> Webhook Actions
            <app-docslink class="ml-3" link="https://swarmio-labs.gitbook.io/platform-documentation/concepts/webhook-actions/webhook-actions"></app-docslink>
        </ng-container>

        <ng-container search>
            <input type="text" placeholder="Search..." name="search" [(ngModel)]="search" class="form-control">
        </ng-container>

        <ng-container actions>
            <fz-dropdown direction="left-start">
                <a button fzButton color="secondary" href="javascript:void(0);">
                    <i class="fas fa-ellipsis-v"></i>
                </a>
                <a fzDropdownItem routerLink="create"><i class="icon m-right fas fa-plus-circle"></i>New Webhook Action</a>
            </fz-dropdown>
        </ng-container>

        <!-- table -->
        <fz-table table *ngIf="(webhookActions | fzFilter: search).length > 0">
            <tr header>
                <th>Name</th>
                <th>Url</th>
                <th>Method</th>
                <th>Max Concurrency</th>
                <th>Max Retries</th>
                <th>Retry Interval</th>
                <th></th>
            </tr>
            <tr *ngFor="let item of webhookActions | fzFilter: search;">
                <th>{{ item.name }}</th>
                <td>{{ item.url }}</td>
                <td>{{ getMethodDisplayText(item.method) }}</td>
                <td>{{ item.max_concurrent_requests }}</td>
                <td>{{ item.max_retries }}</td>
                <td>{{ item.retry_interval }}</td>
                <td>
                    <div class="d-flex justify-content-end">
                        <a fzTip content="Reset position" href="javascript:void(0);"
                           (click)="webhookAction = item; resetPositionModal.show()" class="mr-2">
                            <fz-icon-color-circle color="secondary" icon="fas fa-history"></fz-icon-color-circle>
                        </a>
                        <a fzTip content="Edit webhook action" class="mr-2" routerLink="{{item.id}}">
                            <fz-icon-color-circle color="secondary" icon="fas fa-pen-square"></fz-icon-color-circle>
                        </a>
                        <a fzTip content="Delete webhook action" href="javascript:void(0);">
                            <fz-icon-color-circle color="danger" icon="fas fa-trash" (click)="webhookAction = item; modal.show()"></fz-icon-color-circle>
                        </a>
                    </div>
                </td>
            </tr>
        </fz-table>

        <div class="pl-3 pt-3" table *ngIf="webhookActions.length > 0 && search && (webhookActions | fzFilter: search).length == 0">
            No results found for <strong>"{{ search }}"</strong>.
        </div>
        <div class="pl-3 pt-3" table *ngIf="webhookActions.length === 0">
            You don't have any webhook actions
        </div>
        <div class="pl-3 pt-3" table>
            <button routerLink="create" class="mr-2 mb-2" fzButton [rounded]="true" color="primary" size="sm">Create New Webhook Action</button>
        </div>
        <!-- footer -->
        <ng-container tRows *ngIf="(webhookActions | fzFilter: search).length > 0" [ngPlural]="webhookActions.length">
            {{ (webhookActions | fzFilter: search).length }}
            <ng-template ngPluralCase="=0">webhook actions</ng-template>
            <ng-template ngPluralCase="=1">webhook action</ng-template>
            <ng-template ngPluralCase="other">webhook actions</ng-template>
        </ng-container>

        <fz-pagination *ngIf="(webhookActions | fzFilter: search).length > 0" pagination
                       [rows]="(webhookActions | fzFilter: search).length" [perPage]="10"
                       [actionNumbers]="false" [textBtNextPrev]="false"></fz-pagination>

    </fz-panel-table>
</div>

<fz-modal-dialog [confirmClose]="true" #modal>
    <ng-container icon><i fzColor textColor="warning" class="fas fa-exclamation-circle"></i></ng-container>
    <div text>
        <h5 class="text-center">Are you sure you want to delete the webhook action named <strong>{{webhookAction?.name}}</strong>?</h5>
        <p class="text-center">This cannot be undone in the future.</p>
    </div>
    <ng-container buttons>
        <button class="mr-2" fzButton [rounded]="true" size="lg" color="primary" (click)="deleteWebhookAction();modal.confirm()">
            Yes
        </button>
        <button fzButton [rounded]="true" size="lg" color="danger" (click)="modal.hide()">No</button>
    </ng-container>
</fz-modal-dialog>
<app-dependency-error-modal errorMessage="The webhook action named {{webhookAction?.name}} could not be deleted because it is currently in use. To delete it, remove it from the outputs of the following:" [dependencies]="dependencies" #dependencyModal></app-dependency-error-modal>
<app-reset-position id="{{webhookAction?.id}}" name="{{webhookAction?.name}}" type="WEBHOOK_ACTION" #resetPositionModal></app-reset-position>
