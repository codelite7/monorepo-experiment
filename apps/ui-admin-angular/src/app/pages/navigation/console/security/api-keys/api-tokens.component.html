<div class="content" *ngIf="apitokens !== undefined">
    <!-- table -->
    <fz-panel-table class="doc-card-margin mt-4">

        <!-- header -->
        <ng-container desc>
            <i class="mr-2 fas fa-key"></i> API Tokens
            <app-docslink class="ml-3" link="https://swarmio-labs.gitbook.io/platform-documentation/api/authentication"></app-docslink>
        </ng-container>

        <ng-container actions>
            <fz-dropdown direction="left-start">
                <a button fzButton color="secondary" href="javascript:void(0);">
                    <i class="fas fa-ellipsis-v"></i>
                </a>
                <a fzDropdownItem routerLink="create"><i class="icon m-right fas fa-plus-circle"></i>New API Token</a>
            </fz-dropdown>
        </ng-container>

        <!-- table -->
        <fz-table table>
            <tr header>
                <th>Name</th>
            </tr>
            <tr *ngFor="let token of apitokens">
                <td><div class="tokenrow">{{ token.name }}</div></td>
                <td>
                    <div class="d-flex justify-content-end">
                        <a fzTip content="Copy api token to clipboard" href="javascript:void(0);" class="mr-2">
                            <fz-icon-color-circle color="secondary" icon="fas fa-clipboard" ngxClipboard [cbContent]="token?.token"></fz-icon-color-circle>
                        </a>
                        <a fzTip content="Delete api token" href="javascript:void(0);">
                            <fz-icon-color-circle color="danger" icon="fas fa-trash" (click)="apitokenToDelete = token; deletemodal.show()"></fz-icon-color-circle>
                        </a>
                    </div>
                </td>
            </tr>
        </fz-table>

        <div class="pl-3 pt-3" table *ngIf="apitokens.length === 0">
            You don't have any api tokens
        </div>
        <div class="pl-3 pt-3" table>
            <button class="mr-2 mb-2" fzButton [rounded]="true" color="primary" size="sm" (click)="createApiTokenModal.show()">Create New API Token</button>
        </div>
        <!-- footer -->
        <ng-container tRows [ngPlural]="apitokens.length">
            {{apitokens.length}}
            <ng-template ngPluralCase="=1">API Token</ng-template>
            <ng-template ngPluralCase="other">API Tokens</ng-template>
        </ng-container>
    </fz-panel-table>
</div>
<!-- delete modal -->
<fz-modal-dialog [confirmClose]="true" #deletemodal>
    <ng-container icon><i fzColor textColor="warning" class="fas fa-exclamation-circle"></i></ng-container>
    <div text>
        <h5 class="text-center">Are you sure you want to delete the api token named {{apitokenToDelete?.name}}?</h5>
        <p class="text-center">This cannot be undone and this api token will stop working.</p>
    </div>
    <ng-container buttons>
        <button class="mr-2" fzButton [rounded]="true" size="lg" color="primary" (click)="deleteApitoken();deletemodal.confirm()">
            Yes
        </button>
        <button fzButton [rounded]="true" size="lg" color="danger" (click)="deletemodal.hide()">No</button>
    </ng-container>
</fz-modal-dialog>

<!-- create modal -->
<fz-modal headerTitle="Create New API Token" footerPosition="end" #createApiTokenModal [centered]="true">
    <ng-container content>
        <form [formGroup]="apiTokenForm" (ngSubmit)="createApitoken()" xmlns="http://www.w3.org/1999/html">
        <div class="form-group">
            <!-- name -->
            <label for="name">Name</label>
            <!-- focux isn't working, not sure why -->
            <input fzFocus focusState="true" type="text" placeholder="Api Token Name" formControlName="name"
                   class="form-control {{name?.invalid && (name?.dirty || name?.touched) && 'is-invalid'}}" id="name"
                   >
            <small fzColor textColor="danger" *ngIf="name?.invalid && (name?.dirty || name?.touched)">
                Required
            </small>
        </div>
        <button class="mr-2" fzButton color="primary" [disabled]="!apiTokenForm.valid" type="submit">Create</button>
        <button type="button" fzButton color="danger" (click)="createApiTokenModal.hide()">Cancel</button>
    </form>
    </ng-container>
</fz-modal>

<!-- create modal -->
<fz-modal headerTitle="Create New API Token" footerPosition="end" #createApiTokenModal [centered]="true">
    <ng-container content>
        <form [formGroup]="apiTokenForm" (ngSubmit)="createApitoken()" xmlns="http://www.w3.org/1999/html">
        <div class="form-group">
            <!-- name -->
            <label for="name">Name</label>
            <!-- focux isn't working, not sure why -->
            <input fzFocus focusState="true" type="text" placeholder="Api Token Name" formControlName="name"
                   class="form-control {{name?.invalid && (name?.dirty || name?.touched) && 'is-invalid'}}" id="name"
                   >
            <small fzColor textColor="danger" *ngIf="name?.invalid && (name?.dirty || name?.touched)">
                Required
            </small>
        </div>
        <button class="mr-2" fzButton color="primary" [disabled]="!apiTokenForm.valid" type="submit">Create</button>
        <button type="button" fzButton color="danger" (click)="createApiTokenModal.hide()">Cancel</button>
    </form>
    </ng-container>
</fz-modal>
